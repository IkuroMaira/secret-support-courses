# üìù Solutions des exercices - Fondamentaux SQL

## Exercice 1 : Jointures et agr√©gation

√âcrivez une requ√™te qui affiche pour chaque utilisateur : son nom, le nombre de publications qu'il a faites, le nombre total de likes re√ßus sur ses publications, et le nombre total de commentaires re√ßus sur ses publications.

### Solution :
```sql
SELECT 
    u.id,
    u.nom,
    COUNT(DISTINCT p.id) AS nombre_publications,
    COUNT(DISTINCT l.id) AS nombre_likes,
    COUNT(DISTINCT c.id) AS nombre_commentaires
FROM 
    utilisateurs u
LEFT JOIN 
    publications p ON u.id = p.utilisateur_id
LEFT JOIN 
    likes l ON p.id = l.publication_id
LEFT JOIN 
    commentaires c ON p.id = c.publication_id
GROUP BY 
    u.id, u.nom;
```

> üí° **Remarque** : Cette solution peut donner des r√©sultats incorrects √† cause du produit cart√©sien. Une meilleure approche utiliserait des sous-requ√™tes :

```sql
SELECT 
    u.id,
    u.nom,
    (SELECT COUNT(*) FROM publications WHERE utilisateur_id = u.id) AS nombre_publications,
    (
        SELECT COUNT(*) 
        FROM publications p
        JOIN likes l ON p.id = l.publication_id
        WHERE p.utilisateur_id = u.id
    ) AS nombre_likes,
    (
        SELECT COUNT(*) 
        FROM publications p
        JOIN commentaires c ON p.id = c.publication_id
        WHERE p.utilisateur_id = u.id
    ) AS nombre_commentaires
FROM 
    utilisateurs u;
```

## Exercice 2 : Recherche avec LIKE

Trouvez toutes les publications dont le contenu contient le mot "SQL" ou "MySQL", et affichez : le contenu de la publication, le nom de l'auteur, et la date de publication.

### Solution :
```sql
SELECT 
    p.contenu,
    u.nom AS auteur,
    p.date_publication
FROM 
    publications p
JOIN 
    utilisateurs u ON p.utilisateur_id = u.id
WHERE 
    p.contenu LIKE '%SQL%' OR p.contenu LIKE '%MySQL%'
ORDER BY 
    p.date_publication DESC;
```

## Exercice 3 : GROUP BY et HAVING

Identifiez les utilisateurs qui ont comment√© plus de 3 publications diff√©rentes, et affichez : le nom de l'utilisateur, le nombre de publications distinctes comment√©es, et la date du commentaire le plus r√©cent.

### Solution :
```sql
SELECT 
    u.nom,
    COUNT(DISTINCT c.publication_id) AS nombre_publications_commentees,
    MAX(c.date_commentaire) AS dernier_commentaire
FROM 
    utilisateurs u
JOIN 
    commentaires c ON u.id = c.utilisateur_id
GROUP BY 
    u.id, u.nom
HAVING 
    nombre_publications_commentees > 3;
```

## Exercice 4 : Requ√™te complexe avec jointures multiples

Cr√©ez une liste d'activit√© qui montre : le type d'activit√© (publication, commentaire, like), le nom de l'utilisateur qui a effectu√© l'action, le contenu (pour les publications et commentaires) ou l'ID de la publication (pour les likes), et la date de l'activit√©, le tout tri√© par date (du plus r√©cent au plus ancien).

### Solution :
```sql
-- Publications
SELECT 
    'Publication' AS type_activite,
    u.nom AS utilisateur,
    p.contenu AS detail,
    p.date_publication AS date_activite
FROM 
    publications p
JOIN 
    utilisateurs u ON p.utilisateur_id = u.id

UNION ALL

-- Commentaires
SELECT 
    'Commentaire' AS type_activite,
    u.nom AS utilisateur,
    c.contenu AS detail,
    c.date_commentaire AS date_activite
FROM 
    commentaires c
JOIN 
    utilisateurs u ON c.utilisateur_id = u.id

UNION ALL

-- Likes
SELECT 
    'Like' AS type_activite,
    u.nom AS utilisateur,
    CONCAT('Like sur publication #', l.publication_id) AS detail,
    l.date_like AS date_activite
FROM 
    likes l
JOIN 
    utilisateurs u ON l.utilisateur_id = u.id

ORDER BY 
    date_activite DESC;
```

---

# üß† R√©ponses au Quiz de r√©vision

1. **Quelle est la diff√©rence entre une cl√© primaire et une cl√© √©trang√®re ?**
    - Une cl√© primaire identifie de fa√ßon unique chaque enregistrement dans une table.
    - Une cl√© √©trang√®re est une colonne qui fait r√©f√©rence √† la cl√© primaire d'une autre table, √©tablissant ainsi une relation entre les deux tables.

2. **Quel est le r√¥le de la clause ON dans une jointure ?**
    - La clause ON sp√©cifie la condition de jointure entre deux tables, indiquant quelles colonnes doivent correspondre pour lier les enregistrements.

3. **Quelle est la diff√©rence entre un INNER JOIN et un LEFT JOIN ?**
    - INNER JOIN retourne uniquement les enregistrements qui ont une correspondance dans les deux tables.
    - LEFT JOIN retourne tous les enregistrements de la table de gauche (premi√®re table), m√™me s'ils n'ont pas de correspondance dans la table de droite.

4. **Pourquoi utilise-t-on des alias avec AS ?**
    - Pour rendre le code plus lisible et concis
    - Pour donner des noms plus descriptifs aux colonnes
    - Pour √©viter les ambigu√Øt√©s lorsque deux tables ont des colonnes portant le m√™me nom
    - Pour simplifier la r√©f√©rence aux tables dans les requ√™tes complexes

5. **Comment peut-on trouver tous les enregistrements dont une colonne contient une certaine cha√Æne de caract√®res ?**
    - En utilisant l'op√©rateur LIKE avec des caract√®res jokers (%) : `WHERE colonne LIKE '%cha√Æne%'`

6. **Quelle est la diff√©rence entre WHERE et HAVING ?**
    - WHERE filtre les lignes individuelles avant le regroupement (GROUP BY)
    - HAVING filtre les groupes apr√®s le regroupement

7. **Quel mot-cl√© utilise-t-on pour trier les r√©sultats d'une requ√™te ?**
    - ORDER BY

8. **Comment compter le nombre de lignes d'une table ?**
    - `SELECT COUNT(*) FROM table;`

9. **Que fait la contrainte ON DELETE CASCADE sur une cl√© √©trang√®re ?**
    - Elle propage automatiquement la suppression : lorsqu'un enregistrement est supprim√© dans la table parent, tous les enregistrements li√©s dans la table enfant sont √©galement supprim√©s.

10. **Quelle clause est n√©cessaire lors de l'utilisation de fonctions d'agr√©gation pour regrouper les r√©sultats ?**
    - GROUP BY